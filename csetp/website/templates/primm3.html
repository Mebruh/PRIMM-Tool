{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center">Primm Question Set 3</h1>
    <p class="text-center">This page will contain interactive PRIMM questions focused on SQL JOINs.</p>
    <p class="text-center">
        Need to review the employee database? 
        <a href="{% url 'employee-list' %}" class="text-primary" target="_blank">Click here</a>.
    </p>
    <p class="text-center">
        Need to review the projects database? 
        <a href="{% url 'project-list' %}" class="text-primary" target="_blank">Click here</a>.
    </p>

    <!-- Section 1: Predict and Run -->
    <div id="section-1" class="section-container fade-in">
        <h2>Predict and Run</h2>
        <p>To answer the following questions you need to have a look at both databases.</p>
        <p>What do you think will happen when the following SQL query is run?</p>
        <pre>SELECT employees.first_name, employees.last_name, projects.project_name 
FROM employees 
INNER JOIN projects ON employees.id = projects.employee_id;</pre>
        
        <form id="predict-form">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="prediction" value="1" id="option1">
                <label class="form-check-label" for="option1">It will return all employees, even those without projects.</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="prediction" value="2" id="option2">
                <label class="form-check-label" for="option2">It will return only employees who have projects.</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="prediction" value="3" id="option3">
                <label class="form-check-label" for="option3">It will return all projects, even those without assigned employees.</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="prediction" value="4" id="option4">
                <label class="form-check-label" for="option4">It will return an error.</label>
            </div>
            <button type="button" class="btn btn-primary btn-pop mt-3" onclick="runPredictQueryJoin('{% url 'run_sql_query_join' %}')">RUN</button>
        </form>
        
        <div id="query-output" class="mt-4" style="display:none;">
            <h3>Query Result:</h3>
            <pre id="result-display"></pre>
            <p id="answer-feedback"></p>
            <button id="next-section-btn" class="btn btn-success btn-pop" style="display:none;" onclick="showNextSection('section-1', 'section-2')">Next Section</button>
        </div>
    </div>

    <!-- Section 2: Investigate -->
    <div id="section-2" style="display:none;" class="section-container mt-5 slide-in">
        <h2>Investigate</h2>
        <p class="alert alert-info">
            Have a look at your answer and the correct one. If they are the same, well done! 
            If not, then investigate any differences.
        </p>
    
        <form id="investigate-form">
            <div class="mb-3">
                <label for="question1" class="form-label">1. What does <code>INNER JOIN</code> do in an SQL query?</label>
                <input type="text" class="form-control" id="question1" name="question1" required>
            </div>
    
            <div class="mb-3">
                <label for="question2" class="form-label">2. Why does <code>ON employees.id = projects.employee_id</code> work as a matching condition?</label>
                <input type="text" class="form-control" id="question2" name="question2" required>
            </div>
    
            <div class="mb-3">
                <label for="question3" class="form-label">3. If <code>INNER JOIN</code> is based on intersection in set theory. What do you think <code>LEFT JOIN</code> is based on?</label>
                <input type="text" class="form-control" id="question3" name="question3" required>
            </div>
    
            <button type="button" class="btn btn-primary btn-pop" id="submit-investigate" disabled onclick="submitInvestigateAnswers()">Submit</button>
        </form>
    
        <div id="investigate-results" class="mt-4" style="display:none;">
            <h3>Correct Answers</h3>
            <p><strong>Question 1:</strong> What does <code>INNER JOIN</code> do in an SQL query?</p>
            <p><strong>Your Answer:</strong> <span id="user-answer1"></span></p>
            <p><strong>Correct Answer:</strong> The <code>INNER JOIN</code> returns only rows where there is a match in both tables.</p>
            <br>
            <p><strong>Question 2:</strong> Why does <code>ON employees.id = projects.employee_id</code> work as a matching condition?</p>
            <p><strong>Your Answer:</strong> <span id="user-answer2"></span></p>
            <p><strong>Correct Answer:</strong> The <code>employees.id</code> is the primary key in the employees table, and <code>projects.employee_id</code> is the foreign key that references it.</p>
            <br>
            <p><strong>Question 3:</strong> If <code>INNER JOIN</code> is based on intersection in set theory. What do you think <code>LEFT JOIN</code> is based on?</p>
            <p><strong>Your Answer:</strong> <span id="user-answer3"></span></p>
            <p><strong>Correct Answer:</strong> <code>LEFT JOIN</code> is based on the **left set with intersection**. It includes all elements of the left table, keeping unmatched ones as NULL.</p>
    
            <button id="next-section-btn-2" class="btn btn-success btn-pop mt-3" style="display:none;" onclick="showNextSection('section-2', 'section-3')">Next Section</button>
        </div>
    </div>

    <!-- Section 3: Modify -->
    <div id="section-3" style="display:none;" class="section-container mt-5 slide-in">
        <h2>Modify</h2>
        <p><strong>Now, modify the query in the following way and observe the output:</strong></p>
        <p>Change the filter: Show only projects that started after <code>January 1, 2023</code>.</p>
    
        <form id="modify-form">
            <textarea class="form-control" id="modify-query" rows="3">SELECT employees.first_name, employees.last_name, projects.project_name 
FROM employees 
INNER JOIN projects ON employees.id = projects.employee_id;</textarea>
            <button type="button" class="btn btn-primary btn-pop mt-3" onclick="runModifiedQueryJoin('{% url 'run_modified_query_join' %}')">Run Query</button>
        </form>
    
        <div id="modify-query-output" class="mt-4" style="display:none;">
            <h3>Query Result:</h3>
            <pre id="modify-result-display"></pre>
            <p id="modify-feedback"></p>
            <button id="next-section-btn-3" class="btn btn-success btn-pop" style="display:none;" onclick="showNextSection('section-3', 'section-4')">Next Section</button>
        </div>
    </div>

    <!-- Section 4: Make -->
    <div id="section-4" style="display:none;" class="section-container mt-5 slide-in">
        <h2>Make</h2>
        <p><strong>Write an SQL query to list all employees who do <u>not</u> have a project assigned.</strong></p>
    
        <form id="make-form">
            <textarea class="form-control" id="make-query" rows="3" placeholder="Write your SQL query here..."></textarea>
            <button type="button" class="btn btn-primary btn-pop mt-3" onclick="runMakeQueryJoin('{% url 'run_make_query_primm3' %}', '{% url 'home' %}')">Submit Query</button>
        </form>
    
        <div id="make-query-output" class="mt-4" style="display:none;">
            <p id="make-feedback"></p>
        </div>
    </div>
</div>

<script src="{% static 'js/common.js' %}"></script>
<script src="{% static 'js/primm3.js' %}"></script>

{% endblock %}